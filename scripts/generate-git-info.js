const fs = require('fs');
const { execSync } = require('child_process');

function run(cmd) {
  try {
    return execSync(cmd, { encoding: 'utf8' }).trim();
  } catch (e) {
    return '';
  }
}

const commitHash = run('git rev-parse --short HEAD');
const commitMessage = run("git log -1 --pretty=%B");
const commitDate = run("git log -1 --date=iso --pretty=%cd");

const content = `// This file is generated by scripts/generate-git-info.js
export const commitHash = ${JSON.stringify(commitHash)};
export const commitMessage = ${JSON.stringify(commitMessage)};
export const commitDate = ${JSON.stringify(commitDate)};
`;

fs.writeFileSync('src/gitInfo.ts', content);
console.log('Wrote src/gitInfo.ts');
